---
title: バイトデータ、エンコーディング、デコーディングの復習  
description: メッセージのエンコーディング／デコーディングの復習  
updated: 2024-05-31  
authors: [martineckardt]  
icon: BookOpen  
---

ブロックチェーン間でメッセージを送信する際、実際には **バイト（bytes）型の単一の値** を送っています。  
この **バイトデータには、異なるデータ型の複数の値（例：文字列、整数、アドレスなど）を格納可能** です。  
この仕組みにより、メッセージのデータを一括でエンコードして送信し、受信側でデコードして元の値を取り出せます。  

このセクションでは、次のトピックを復習します。  

- **Bytes:** このデータ型の特徴と、なぜ使用するのか  
- **Encoding:** 値をバイトデータに変換する方法  
- **Decoding:** バイトデータを元の値に戻す方法  

これらの概念は、今後メッセージの送受信を行う際に **頻繁に使用** するため、しっかり理解しておきましょう。  

## Bytes（バイトデータ型とは？）  

Solidity における **bytes（バイト）型** は、異なる種類の値を **1つのデータにまとめる** ことができる便利なデータ型です。  
これは **異なるデータ型（整数、テキスト、画像、バイナリデータなど）を 1つのデータに統合する** ために使用されます。  

イメージとしては、**「複数のデータを収納できるボックス」** のようなものです。  
この **バイト型データをエンコードしてブロックチェーン間で送信し、受信側でデコードして元の値を取り出す** という仕組みを活用することで、効率的なデータ通信が可能になります。  

## エンコーディング & デコーディング（Encoding & Decoding）  

Solidity では、**エンコーディング（データの変換）** や **デコーディング（元のデータへの復元）** を行うために、以下の関数を使用します。  

- **`abi.encode()`** → 値をバイトデータに変換（エンコーディング）  
- **`abi.decode()`** → バイトデータを元の値に戻す（デコーディング）  

これらの関数は **Solidity に標準搭載されているため、特別なインポートは不要** です。  

![Encoding and Decoding](/common-images/solidity/encoding-decoding.png)  

### **エンコーディング（Encoding）**  

データを **バイト配列に変換する** ことで、複数の値を **1つのメッセージにまとめる** ことができます。  
これにより、スマートコントラクト間でデータをやり取りする際に **効率的に送信できる** ようになります。  

```solidity
string memory someString = "test";
uint someNumber = 42;

bytes message = abi.encode(someString, someNumber);
```

この `message` という **バイト型のデータ** を使って、**Teleporter を介してメッセージを送信** できます。  

### **デコーディング（Decoding）**  

データを受信した側は、**バイトデータを元の形式に戻す** 必要があります。  
そのためには、`abi.decode()` を使用して **元のデータ型に変換** します。  

```solidity
( 
  string memory someString,
  uint someNumber
) = abi.decode(message, (string, uint));
```

この処理を実行すると、エンコーディング時に格納した **文字列 (`someString`) と 数値 (`someNumber`) を取り出す** ことができます。  

### **重要なポイント**  
デコーディングする際は、**エンコード時のデータ型や順番を正しく指定する必要がある** ため注意してください。  
間違ったデータ型や順番でデコードすると、正しくデータを取得できなくなります。  

<Quiz quizId="303"/>  