---
title: é–¢æ•°åã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰  
description: 1 ã¤ã®ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒ¼ãƒ³ dApp ã§è¤‡æ•°ã®é–¢æ•°ã‚’æ‰±ã†  
updated: 2024-05-31  
authors: [martineckardt]  
icon: BookOpen  
---

import { Step, Steps } from 'fumadocs-ui/components/steps';

**ã‚ˆãã§ãã¾ã—ãŸï¼**  
ã“ã‚Œã¾ã§ã«ã€**è¤‡æ•°ã®å€¤ã‚’ 1 ã¤ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•** ã‚’å­¦ã³ã¾ã—ãŸã€‚  
ã“ã®ç« ã§ã¯ã€**é–¢æ•°åã‚‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã€é©åˆ‡ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å«ã‚ã‚‹æ–¹æ³•** ã‚’å­¦ã³ã¾ã™ã€‚  

ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãª **ã‚ˆã‚Šé«˜åº¦ãªè¨ˆç®—æ©Ÿ** ã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚  

- `add` é–¢æ•°ï¼ˆ2 ã¤ã®æ•°å€¤ã‚’åŠ ç®—ï¼‰  
- `concatenate` é–¢æ•°ï¼ˆ2 ã¤ã®æ–‡å­—åˆ—ã‚’çµåˆï¼‰  

`add` ã§ã¯ **æ•°å€¤ 2 ã¤** ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€`concatenate` ã§ã¯ **æ–‡å­—åˆ— 2 ã¤** ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
ã“ã‚Œã‚’ã©ã®ã‚ˆã†ã«å‡¦ç†ã™ã‚‹ã‹ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚  

![](/common-images/teleporter/message-function-call.png)

## **é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰**  

### **ã‚¹ãƒ†ãƒƒãƒ— 1: é–¢æ•°åã‚’è¡¨ã™ `enum` ã‚’ä½œæˆã™ã‚‹**  

ã¾ãšã€å‘¼ã³å‡ºã™é–¢æ•°ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã® `CalculatorAction` **åˆ—æŒ™å‹ï¼ˆenumï¼‰** ã‚’ä½œæˆã—ã¾ã™ã€‚  

```solidity title="contracts/interchain-messaging/invoking-functions/CalculatorActions.sol"
pragma solidity ^0.8.18;

enum CalculatorAction {
    add,
    concatenate
}
```

ã“ã® `enum` ã‚’åˆ©ç”¨ã—ã¦ã€é€ä¿¡ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ **ã©ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¹ãã‹** ã‚’æŒ‡å®šã—ã¾ã™ã€‚  

---

### **ã‚¹ãƒ†ãƒƒãƒ— 2: é€ä¿¡ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã« `encode helpers` ã‚’è¿½åŠ ã™ã‚‹**  

æ¬¡ã«ã€`CalculatorAction` ã‚’ä½¿ç”¨ã—ã¦é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä¸€ç·’ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  

```solidity title="contracts/interchain-messaging/invoking-functions/CalculatorSenderOnCChain.sol"
pragma solidity ^0.8.18;

import "@teleporter/ITeleporterMessenger.sol";
import "./CalculatorActions.sol"; // [!code highlight]

contract CalculatorSenderOnCChain {
    ITeleporterMessenger public immutable teleporterMessenger =
        ITeleporterMessenger(0x253b2784c75e510dD0fF1da844684a1aC0aa5fcf);

    function sendAddMessage(address destinationAddress, uint256 num1, uint256 num2) external {
        teleporterMessenger.sendCrossChainMessage(
            TeleporterMessageInput({
                // Replace with chain id of your Avalanche L1 (see instructions in Readme)
                destinationBlockchainID: 0x92756d698399805f0088fc07fc42af47c67e1d38c576667ac6c7031b8df05293,
                destinationAddress: destinationAddress,
                feeInfo: TeleporterFeeInfo({feeTokenAddress: address(0), amount: 0}),
                requiredGasLimit: 100000,
                allowedRelayerAddresses: new address[](0),
                message: encodeAddData(num1, num2) // [!code highlight]
            })
        );
    }

    function sendConcatenateMessage(address destinationAddress, string memory text1, string memory text2) external {
        teleporterMessenger.sendCrossChainMessage(
            TeleporterMessageInput({
                // Replace with chain id of your Avalanche L1 (see instructions in Readme)
                destinationBlockchainID: 0x382d2a20c299b03b638dd4d42b96e7401f6c3e88209b764abce83cf71c0c30cd,
                destinationAddress: destinationAddress,
                feeInfo: TeleporterFeeInfo({feeTokenAddress: address(0), amount: 0}),
                requiredGasLimit: 100000,
                allowedRelayerAddresses: new address[](0),
                message: encodeConcatenateData(text1, text2) // [!code highlight]
            })
        );
    }

    // Encode helpers
    function encodeAddData(uint256 a, uint256 b) public pure returns (bytes memory) {
        bytes memory paramsData = abi.encode(a, b); // [!code highlight:2]
        return abi.encode(CalculatorAction.add, paramsData);
    }

    function encodeConcatenateData(string memory a, string memory b) public pure returns (bytes memory) {
        bytes memory paramsData = abi.encode(a, b); // [!code highlight:2]
        return abi.encode(CalculatorAction.concatenate, paramsData);
    }
}
```

---

### **ğŸ“Œ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ**  

#### **â‘  `enum` ã§é–¢æ•°ã®ç¨®é¡ã‚’æŒ‡å®š**
- `CalculatorAction.add` â†’ `add` é–¢æ•°ã‚’å®Ÿè¡Œ  
- `CalculatorAction.concatenate` â†’ `concatenate` é–¢æ•°ã‚’å®Ÿè¡Œ  

#### **â‘¡ é€ä¿¡ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ–¹æ³•**
é–¢æ•°ã”ã¨ã« **2 å› `abi.encode()`** ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€**é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã‚‹** ã“ã¨ãŒã§ãã¾ã™ã€‚  

- **`encodeAddData()`**
  ```solidity
  bytes memory paramsData = abi.encode(a, b);  // 2 ã¤ã® `uint256` ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
  return abi.encode(CalculatorAction.add, paramsData);  // é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
  ```
- **`encodeConcatenateData()`**
  ```solidity
  bytes memory paramsData = abi.encode(a, b);  // 2 ã¤ã® `string` ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
  return abi.encode(CalculatorAction.concatenate, paramsData);  // é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã¾ã¨ã‚ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
  ```

## é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ã‚³ãƒ¼ãƒ‰  

**å—ä¿¡ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§é–¢æ•°åã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€é©åˆ‡ãªå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•** ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚  

```solidity title="contracts/interchain-messaging/invoking-functions/CalculatorReceiverOnSubnet.sol"
pragma solidity ^0.8.18;

import "@teleporter/ITeleporterMessenger.sol";
import "@teleporter/ITeleporterReceiver.sol";
import "./CalculatorActions.sol";

contract CalculatorReceiverOnSubnet is ITeleporterReceiver {
    ITeleporterMessenger public immutable teleporterMessenger =
        ITeleporterMessenger(0x253b2784c75e510dD0fF1da844684a1aC0aa5fcf);
    uint256 public result_num;
    string public result_string;

    function receiveTeleporterMessage(bytes32, address, bytes calldata message) external {
        // Only the Interchain Messaging receiver can deliver a message.
        require(
            msg.sender == address(teleporterMessenger), "CalculatorReceiverOnSubnet: unauthorized TeleporterMessenger"
        );

        // Decoding the Action type: // [!code highlight:2]
        (CalculatorAction actionType, bytes memory paramsData) = abi.decode(message, (CalculatorAction, bytes)); 

        // Route to the appropriate function. // [!code highlight:10]
        if (actionType == CalculatorAction.add) {
            (uint256 a, uint256 b) = abi.decode(paramsData, (uint256, uint256));
            _calculatorAdd(a, b);
        } else if (actionType == ...) {
            (string memory text1, string memory text2) = abi.decode(paramsData, (string, string));
            _calculatorConcatenateStrings(text1, text2);
        } else {
            revert("CalculatorReceiverOnSubnet: invalid action");
        }
    }

    function _calculatorAdd(uint256 _num1, uint256 _num2) internal {
        result_num = _num1 + _num2;

    }

    function _calculatorConcatenateStrings(string memory str1, string memory str2) internal {
        bytes memory str1Bytes = bytes(str1);
        bytes memory str2Bytes = bytes(str2);

        bytes memory combined = new bytes(str1Bytes.length + str2Bytes.length + 1);

        for (uint256 i = 0; i < str1Bytes.length; i++) {
            combined[i] = str1Bytes[i];
        }
        combined[str1Bytes.length] = " ";
        for (uint256 i = 0; i < str2Bytes.length; i++) {
            combined[str1Bytes.length + i + 1] = str2Bytes[i];
        }

        result_string = string(combined);
    }
}
```

---

## **ğŸ“Œ ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ**  

### **â‘  é–¢æ•°åã®ãƒ‡ã‚³ãƒ¼ãƒ‰**  

```solidity
// Decoding the Action type: 
(CalculatorAction actionType, bytes memory paramsData) = abi.decode(message, (CalculatorAction, bytes)); 
```

å—ã‘å–ã£ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æœ€åˆã®éƒ¨åˆ†ã« **é–¢æ•°åï¼ˆ`CalculatorAction`ï¼‰** ãŒã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€  
ã¾ãš **é–¢æ•°åï¼ˆ`actionType`ï¼‰** ã‚’å–å¾—ã—ã¦ã‹ã‚‰æ¬¡ã« **é–¢æ•°ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ`paramsData`ï¼‰** ã‚’å–å¾—ã—ã¾ã™ã€‚  

---

### **â‘¡ é–¢æ•°åã«å¿œã˜ãŸãƒ‡ã‚³ãƒ¼ãƒ‰ã¨å‡¦ç†ã®å®Ÿè¡Œ**  

```solidity
// Route to the appropriate function. 
if (actionType == CalculatorAction.add) {
    (uint256 a, uint256 b) = abi.decode(paramsData, (uint256, uint256)); // [!code highlight]
    _calculatorAdd(a, b);
} else if (actionType == ...) {
    (string memory text1, string memory text2) = abi.decode(paramsData, (string, string)); // [!code highlight]
    _calculatorConcatenateStrings(text1, text2);
} else {
    revert("CalculatorReceiverOnSubnet: invalid action");
}
```

- `CalculatorAction.add` â†’ 2 ã¤ã®æ•°å€¤ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€`_calculatorAdd()` ã‚’å®Ÿè¡Œ  
- `CalculatorAction.concatenate` â†’ 2 ã¤ã®æ–‡å­—åˆ—ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€`_calculatorConcatenateStrings()` ã‚’å®Ÿè¡Œ  
- ä¸Šè¨˜ä»¥å¤–ã®é–¢æ•°åãŒé€ã‚‰ã‚ŒãŸå ´åˆã¯ `revert` ã§ã‚¨ãƒ©ãƒ¼ã‚’ç™ºç”Ÿã•ã›ã‚‹  

## å®Ÿéš›ã«è©¦ã—ã¦ã¿ã‚ˆã†  

Sender ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã¨ Receiver ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã€`add`ï¼ˆåŠ ç®—ï¼‰ã¨ `concatenate`ï¼ˆæ–‡å­—åˆ—çµåˆï¼‰ã®é–¢æ•°ã‚’å®Ÿéš›ã«å‹•ã‹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  

<Steps>  
<Step>  

### **Sender ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹**  

<Callout type="warn" title="CalculatorSenderOnCChain ã® BOTH destinationBlockchainIDs ã‚’ Avalanche L1 ã® Blockchain ID (HEX) ã«å¤‰æ›´ã™ã‚‹ã®ã‚’å¿˜ã‚Œãªã„ã‚ˆã†ã«ï¼" />

```bash
forge create --rpc-url local-c --private-key $PK contracts/interchain-messaging/invoking-functions/CalculatorSenderOnCChain.sol:CalculatorSenderOnCChain
```
```
[â ƒ] Compiling...
[â †] Compiling 2 files with Solc 0.8.18
[â °] Solc 0.8.18 finished in 240.23ms
Compiler run successful!
Deployer: 0x8db97C7cEcE249c2b98bDC0226Cc4C2A57BF52FC
Deployed to: 0x8B3BC4270BE2abbB25BC04717830bd1Cc493a461 // [!code highlight]
Transaction hash: 0xf9cce28a714764bb265bba7522bfd10d620fa0cb0f5dae26de2ac773b0a878ee
```

</Step>  
<Step>  

### **Sender ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¿å­˜ã™ã‚‹**  

```bash
export SENDER_ADDRESS=0x8B3BC4270BE2abbB25BC04717830bd1Cc493a461
```

</Step>  
<Step>  

### **Receiver ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹**  

```bash
forge create --rpc-url myblockchain --private-key $PK contracts/interchain-messaging/invoking-functions/CalculatorReceiverOnSubnet.sol:CalculatorReceiverOnSubnet
```
```
[â Š] Compiling...
[â ¢] Compiling 1 files with Solc 0.8.18
[â †] Solc 0.8.18 finished in 148.40ms
Compiler run successful!
Deployer: 0x8db97C7cEcE249c2b98bDC0226Cc4C2A57BF52FC
Deployed to: 0x5DB9A7629912EBF95876228C24A848de0bfB43A9 // [!code highlight]
Transaction hash: 0xa8efb88abfef486d2caba30cb4146b1dc56a0ee88c7fb4c46adccdf1414ae39e
```

</Step>  
<Step>  

### **Receiver ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¿å­˜ã™ã‚‹**  

```bash
export RECEIVER_ADDRESS=0x5DB9A7629912EBF95876228C24A848de0bfB43A9
```

</Step>  
<Step>  

### **é–¢æ•°ã‚’å‘¼ã³å‡ºã™**  

Sender ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã® `sendAddMessage` ã‚„ `sendConcatenateMessage` ã‚’å‘¼ã³å‡ºã—ã€Receiver ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§å‡¦ç†ã•ã‚Œã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
cast send --rpc-url local-c --private-key $PK $SENDER_ADDRESS "sendAddMessage(address, uint, uint)" $RECEIVER_ADDRESS 1 2
```

</Step>  
<Step>  

### **çµæœã‚’ç¢ºèªã™ã‚‹**  

Receiver ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã® `result_num()` ã‚’å‘¼ã³å‡ºã—ã€è¨ˆç®—çµæœã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
cast call --rpc-url myblockchain $RECEIVER_ADDRESS "result_num()(uint)"
```
æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```bash
3
```
ï¼ˆ1 + 2 = 3 ã®è¨ˆç®—çµæœï¼‰  

</Step>  
</Steps>  

<Quiz quizId="307"/>