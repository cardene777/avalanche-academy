---
title: メッセージの送信
description: リレイヤーがメッセージを送信する役割について学ぶ  
updated: 2024-05-31  
authors: [martineckardt]  
icon: BookOpen  
---

import { Step, Steps } from 'fumadocs-ui/components/steps';

次に、AWM リレイヤーは、集約された署名付きのメッセージを送信先の Avalanche L1 にトランザクションとして送信し、メッセージを配信します。このトランザクションは、通常のトランザクションと同様に送信先のブロックチェーンのバリデータセットによって伝播されます。

トランザクションを送信するために、AWM リレイヤーは送信先ブロックチェーンのガス代に使用するネイティブトークンを保有しているウォレットの秘密鍵にアクセスし、トランザクションに署名する必要があります。

![](/common-images/awm/relayer-delivery.png)

バリデータがトランザクションを検証するとき、以下の手順を実行します。

<Steps>
<Step>

### P-チェーンの照会  
送信先 L1 のバリデータは、それぞれ P-チェーンに問い合わせ、送信元 Avalanche L1 のバリデータセットとそのステークの重み、および BLS 公開鍵を取得します。

</Step>

<Step>

### 十分なステークの確認  
最初に、送信元の Avalanche L1 のバリデータのうち、Warp メッセージに署名したバリデータの合計ステークの重みがメッセージを受け入れるのに十分であるかを確認します（例: 送信元チェーンの総ステークの 50% を超えるバリデータが署名している）。  
送信先チェーンは、送信元チェーンごとに受け入れるためのステークの割合を自由に設定できます。例えば、Avalanche L1 はチェーン A からのメッセージには 50%、チェーン B からのメッセージには 90% のステークを要求することができます。  
もし、集約署名に含まれるバリデータのステークの重みが不足している場合、メッセージは拒否されます。

</Step>

<Step>

### BLS 公開鍵の集約  
送信先 L1 のバリデータは、送信元 L1 のバリデータのうち、メッセージに署名したバリデータの BLS 公開鍵を集約します。

</Step>

<Step>

### BLS マルチ署名の検証  
集約された署名（AWM リレイヤーによって作成）を、集約された BLS 公開鍵（送信先 L1 のバリデータによって集約）を使用して検証します。  
もし検証が失敗した場合（例: AWM リレイヤーがメッセージを改ざんしていた場合）、メッセージは拒否されます。

</Step>

<Step>

### メッセージの実行  
検証に成功した場合、メッセージが実行されます。

</Step>

</Steps>

## なぜ AWM リレイヤーは BLS 公開鍵を集約しないのか？

BLS 公開鍵の集約は、送信先サブネットのすべてのバリデータによって実行されなければなりません。一部の人は「この処理を AWM リレイヤーがオフチェーンで行い、メッセージに添付すればいいのでは？」と考えるかもしれません。

たしかに、この方法を取れば検証は高速化できます。しかし、そこにはセキュリティ上の問題があります。  
「集約された公開鍵が、本当に署名したバリデータの公開鍵を正しく表しているのか？」  
「AWM リレイヤーが勝手に公開鍵を作成し、それに合う署名を生成しただけではないのか？」  

この疑問を解決する唯一の方法は、署名したバリデータの公開鍵を自分たちで集約し、それを AWM リレイヤーが送ったものと比較することです。したがって、リレイヤーが公開鍵を事前に集約してメッセージに添付することには意味がありません。

<Quiz quizId="314"/>