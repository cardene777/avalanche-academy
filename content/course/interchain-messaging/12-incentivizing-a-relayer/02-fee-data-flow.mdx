---
title: 手数料のデータフロー  
description: 手数料インセンティブの仕組みを理解する  
updated: 2024-06-09  
authors: [andyvargtz]  
icon: BookOpen  

---

## **手数料によるインセンティブの基本**  

外部の AWM リレイヤーにメッセージを転送してもらうためには、**リレイヤーが報酬として受け取れるように、Interchain Messaging コントラクトに ERC-20 トークンをデポジット** する必要があります。  

ここでは、**ユーザーがクロスチェーンメッセージを送信する最初の段階から、リレイヤーが手数料を受け取るまでの流れ** を見ていきます。  

![AWM リレイヤーの手数料データフロー](/common-images/teleporter/teleporter-fees-receipt.png)  

**各アクターの役割を示す絵文字**  

- **👩 ユーザー**  
- **📜 クロスチェーン dApp**  
- **👾 TeleporterMessenger（Interchain Messaging コントラクト）**  
- **🛸 リレイヤー**  

---

## **メッセージ送信前の準備**  

- 👩 ユーザーは、手数料として使用する ERC-20 トークンの支払いを許可するため、**クロスチェーン dApp に対して ERC-20 コントラクトの`approve`処理を実行して、`transfer`権限を承認** する。  

---

## **メッセージの送信プロセス**  

1. 👩 ユーザーがメッセージを送信する。  
2. 📜 **ユーザーのウォレットから手数料トークンがクロスチェーン dApp に送付される。**  
3. 📜 **クロスチェーン dApp が Interchain Messaging コントラクト（TeleporterMessenger）に対し、手数料トークンの使用許可を与える。**  
4. 👾 **Interchain Messaging コントラクトが手数料トークンを受け取り、保管する。**  
5. 👾 メッセージに **一意の ID（messageID）を割り当て、手数料情報を記録する。**  
6. 🛸 **リレイヤーは、メッセージをピックアップして転送できるようになる。**  

---

## **メッセージの送信先チェーンでの処理**  

1. 👾 **送信先チェーンの Interchain Messaging コントラクトが `messageID` を含むレシートを生成し、メッセージを送信したリレイヤーのアドレスを記録する。**  
2. 📜 レシートが元のチェーン（送信元）に送信される。  
3. 🛸 **リレイヤーは、レシートを手動で送信することもできるし、新しいメッセージが送信されるのを待って、その中に最大 5 つのレシートを含めることもできる。**  

---

## **元のチェーン（送信元）での処理**  

1. 👾 **Interchain Messaging コントラクトが `messageID` を受信済みにマークし、リレイヤーの報酬をロック解除する。**  
2. 🛸 **リレイヤーは、受け取るべき手数料を請求できるようになる。**  

---

## **開発者が実装すべき内容**  

上記のプロセスを見ると、**クロスチェーン dApp 開発者が実装する必要があるのは、ユーザーが適切に手数料を支払えるようにする部分だけ** であることがわかります。それ以外の処理は **Interchain Messaging コントラクトとリレイヤーが自動的に処理** します。  

**もし自分でリレイヤーを運用する場合は、手数料を設定する必要はありません。**  

<Quiz quizId="315"/>